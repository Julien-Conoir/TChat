# ğŸ’¬ TChat - Application de Messagerie en Temps RÃ©el

<p align="center">
  <img src="https://img.shields.io/badge/Spring%20Boot-3.4.6-brightgreen?style=for-the-badge&logo=springboot" alt="Spring Boot"/>
  <img src="https://img.shields.io/badge/Java-21-orange?style=for-the-badge&logo=openjdk" alt="Java"/>
  <img src="https://img.shields.io/badge/MongoDB-8.0-green?style=for-the-badge&logo=mongodb" alt="MongoDB"/>
  <img src="https://img.shields.io/badge/Kafka-Latest-black?style=for-the-badge&logo=apachekafka" alt="Kafka"/>
  <img src="https://img.shields.io/badge/Docker-Ready-blue?style=for-the-badge&logo=docker" alt="Docker"/>
</p>

TChat est une application de messagerie en temps rÃ©el construite avec une architecture microservices moderne. Elle permet aux utilisateurs d'Ã©changer des messages privÃ©s et de groupe de maniÃ¨re instantanÃ©e.

---

## ğŸ“‹ Table des matiÃ¨res

- [ğŸ—ï¸ Architecture](#ï¸-architecture)
- [ğŸ› ï¸ PrÃ©requis](#ï¸-prÃ©requis)
- [ğŸš€ DÃ©marrage rapide](#-dÃ©marrage-rapide)
- [ğŸ“¦ Modules](#-modules)
- [ğŸ”Œ API Endpoints](#-api-endpoints)
- [ğŸ³ Docker](#-docker)
- [ğŸ“ Technologies](#-technologies)

---

## ğŸ—ï¸ Architecture

TChat utilise une **architecture microservices** avec les composants suivants :

![Schema Architecture](./schÃ©ma_architecture_CONOIR_PAWLOWSKI_LIETARD.png)

---

## ğŸ› ï¸ PrÃ©requis

Avant de commencer, assurez-vous d'avoir installÃ© :

| Outil | Version | Lien |
|-------|---------|------|
| **Java JDK** | 21+ | [Download](https://adoptium.net/) |
| **Maven** | 3.9+ | [Download](https://maven.apache.org/download.cgi) |
| **Docker** | 24+ | [Download](https://www.docker.com/products/docker-desktop/) |
| **Docker Compose** | 2.0+ | Inclus avec Docker Desktop |

### VÃ©rification des installations

```bash
# VÃ©rifier Java
java -version

# VÃ©rifier Maven
mvn -version

# VÃ©rifier Docker
docker --version
docker-compose --version
```

---

## ğŸš€ DÃ©marrage rapide

### Etape 1 : Lancement des instances BDD et Kafka avec Docker

```bash
# 1. Se positionner Ã  la racine du projet
cd path/tchat

# 2. DÃ©marrer les services d'infrastructure (MongoDB + Kafka)
docker-compose up -d

# 3. VÃ©rifier que les services sont lancÃ©s
docker-compose ps
```

### Etape 2 : Lancement des microservices

#### Avec Maven Wrapper (Windows)

```powershell
# Depuis la racine du projet

# Compiler tous les modules
cd auth
.\mvnw.cmd clean install -DskipTests

# Lancer chaque service dans un terminal sÃ©parÃ©

# Terminal 1 - Auth Service
cd auth
.\mvnw.cmd spring-boot:run

# Terminal 2 - Channel Service
cd channel
.\mvnw.cmd spring-boot:run

# Terminal 3 - Message Service
cd message
.\mvnw.cmd spring-boot:run

# Terminal 4 - Push Service
cd push
.\mvnw.cmd spring-boot:run

# Terminal 5 - Gateway (Ã  lancer en dernier)
cd gateway
.\mvnw.cmd spring-boot:run
```

#### Avec Maven (Linux/Mac)

```bash
# Compiler tous les modules
./mvnw clean install -DskipTests

# Lancer chaque service
./mvnw spring-boot:run -pl auth
./mvnw spring-boot:run -pl channel
./mvnw spring-boot:run -pl message
./mvnw spring-boot:run -pl push
./mvnw spring-boot:run -pl gateway
```

## ğŸ“¦ Modules

### ğŸŒ Gateway (Port 8080)
Point d'entrÃ©e unique de l'application. GÃ¨re le routage et la sÃ©curitÃ©.

- **Routage** : Redirige les requÃªtes vers les microservices appropriÃ©s
- **SÃ©curitÃ©** : VÃ©rifie les tokens via le service Auth
- **Headers** : Ajoute `X-User-Id` aux requÃªtes authentifiÃ©es

### ğŸ” Auth (Port 8081)
Gestion de l'authentification et des utilisateurs.

| Endpoint | MÃ©thode | Description | Auth |
|----------|---------|-------------|------|
| `/auth/register` | POST | Inscription d'un utilisateur | âŒ |
| `/auth/login` | POST | Connexion et obtention du token | âŒ |
| `/auth/token` | GET | VÃ©rification du token | âœ… |

### ğŸ“¨ Message (Port 8083)
Gestion des messages privÃ©s entre utilisateurs.

| Endpoint | MÃ©thode | Description | Auth |
|----------|---------|-------------|------|
| `/messages` | POST | Envoyer un message privÃ© | âœ… |
| `/messages/{nickname}` | GET | RÃ©cupÃ©rer les messages avec un utilisateur | âœ… |

### ğŸ“¢ Channel (Port 8082)
Gestion des canaux de discussion de groupe.

| Endpoint | MÃ©thode | Description | Auth |
|----------|---------|-------------|------|
| `/channels` | POST | CrÃ©er un channel | âœ… |
| `/channels` | GET | Lister les channels | âœ… |
| `/channels/{channelName}` | DELETE | Supprimer un channel | âœ… |
| `/channels/{channelName}/subscribe` | POST | Rejoindre un channel | âœ… |
| `/channels/{channelName}/unsubscribe` | POST | Quitter un channel | âœ… |
| `/channels/{channelName}/messages` | POST | Envoyer un message dans le channel | âœ… |
| `/channels/{channelName}/messages` | GET | RÃ©cupÃ©rer les messages du channel | âœ… |

### ğŸ“¤ Push (Port 8084 + TCP 9999)
Service de notification en temps rÃ©el.

- **Kafka Consumer** : Ã‰coute les messages des topics utilisateurs
- **TCP Server** : Maintient les connexions avec les clients connectÃ©s
- **Connexion** : Les clients se connectent via TCP avec leur token

---

## ğŸ”Œ API Endpoints

### Authentification

#### Inscription
```bash
curl -X POST http://localhost:8080/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "nickname": "alice",
    "password": "password"
  }'
```

#### Connexion
```bash
curl -X POST http://localhost:8080/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "nickname": "alice",
    "password": "password"
  }'
```

#### Validation token
```bash
curl -X POST http://localhost:8080/auth/token \
  -H "Authorization: <TOKEN>"
```

**RÃ©ponse connexion et validation token :**
```json
{
  "nickname": "alice",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### Messages privÃ©s

#### Envoyer un message
```bash
curl -X POST http://localhost:8080/messages \
  -H "Content-Type: application/json" \
  -H "Authorization: <TOKEN>" \
  -d '{
    "receiverNickname": "alice",
    "content": "Salut ! Comment vas-tu ?"
  }'
```

#### RÃ©cupÃ©rer tous ses messages privÃ©s
```bash
curl -X GET http://localhost:8080/messages \
  -H "Authorization: <TOKEN>"
```

### Channels

#### CrÃ©er un channel
```bash
curl -X POST http://localhost:8080/channels \
  -H "Content-Type: application/json" \
  -H "Authorization: <TOKEN>" \
  -d '{
    "channelName": "general"
  }'
```

#### Supprimer un channel
```bash
curl -X DELETE http://localhost:8080/channels/{channelName} \
  -H "Authorization: <TOKEN>"
```

#### Rejoindre un channel
```bash
curl -X POST http://localhost:8080/channels/{channelName}/subscribe \
  -H "Authorization: <TOKEN>"
```

#### Quitter un channel
```bash
curl -X POST http://localhost:8080/channels/{channelName}/unsubscribe \
  -H "Authorization: <TOKEN>"
```

---

## ğŸ³ Docker

### Commandes Docker utiles

```bash
# DÃ©marrer tous les services d'infrastructure
docker-compose up -d

# Voir les logs
docker-compose logs -f

# Voir les logs d'un service spÃ©cifique
docker-compose logs -f kafka

# ArrÃªter tous les services
docker-compose down

# ArrÃªter et supprimer les volumes (reset complet)
docker-compose down -v

# Reconstruire les images
docker-compose build --no-cache

# RedÃ©marrer un service
docker-compose restart kafka
```

### Ã‰tat des conteneurs

```bash
# Voir l'Ã©tat des conteneurs
docker-compose ps

# Voir l'utilisation des ressources
docker stats
```

---

## ğŸ“ Technologies

### Backend
- **Spring Boot** - Framework Java
- **Spring Cloud Gateway** - API Gateway
- **Spring Data MongoDB** - Persistance des donnÃ©es
- **Spring Kafka** - Messaging asynchrone
- **MapStruct** - Mapping d'objets
- **Lombok** - RÃ©duction du boilerplate

### Infrastructure
- **MongoDB 8.0** - Base de donnÃ©es NoSQL
- **Apache Kafka** - Message broker
- **Docker** - Conteneurisation

### SÃ©curitÃ©
- **Authorization** - Authentification par token
- **BCrypt** - Hashage des mots de passe

---

## ğŸ“ Structure du projet

```
TChat/
â”œâ”€â”€ ğŸ“ auth/                    # Service d'authentification
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/tchat/auth/
â”‚   â”‚       â”œâ”€â”€ config/         # Configuration (Kafka)
â”‚   â”‚       â”œâ”€â”€ controller/     # REST Controllers
â”‚   â”‚       â”œâ”€â”€ dto/            # Data Transfer Objects
â”‚   â”‚       â”œâ”€â”€ entity/         # EntitÃ©s MongoDB
â”‚   â”‚       â”œâ”€â”€ exception/      # Gestion des exceptions
â”‚   â”‚       â”œâ”€â”€ mapper/         # MapStruct mappers
â”‚   â”‚       â”œâ”€â”€ repository/     # Repositories MongoDB
â”‚   â”‚       â””â”€â”€ service/        # Logique mÃ©tier
â”‚   â””â”€â”€ src/main/resources/
â”‚       â””â”€â”€ application.yml
â”‚
â”œâ”€â”€ ğŸ“ channel/                 # Service de channels
â”‚   â””â”€â”€ (mÃªme structure que auth)
â”‚
â”œâ”€â”€ ğŸ“ message/                 # Service de messages
â”‚   â””â”€â”€ (mÃªme structure que auth)
â”‚
â”œâ”€â”€ ğŸ“ gateway/                 # API Gateway
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/tchat/gateway/
â”‚   â”‚       â”œâ”€â”€ config/         # Configuration routes
â”‚   â”‚       â”œâ”€â”€ dto/            # DTOs
â”‚   â”‚       â””â”€â”€ filter/         # Filtres de sÃ©curitÃ©
â”‚   â””â”€â”€ src/main/resources/
â”‚       â””â”€â”€ application.yml
â”‚
â”œâ”€â”€ ğŸ“ push/                    # Service de push
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/alom/push/
|   |       â”œâ”€â”€ client/         # Appel service Client
â”‚   â”‚       â”œâ”€â”€ config/         # Configuration Kafka
â”‚   â”‚       â”œâ”€â”€ dto/            # DTOs
â”‚   â”‚       â”œâ”€â”€ kafka/          # Consumers Kafka
â”‚   â”‚       â”œâ”€â”€ service/        # Services
â”‚   â”‚       â””â”€â”€ tcp/            # Serveur TCP
â”‚   â””â”€â”€ src/main/resources/
â”‚       â””â”€â”€ application.yml
â”‚
â”œâ”€â”€ ğŸ“„ docker-compose.yml       # Configuration Docker
â”œâ”€â”€ ğŸ“„ pom.xml                  # POM parent Maven
â””â”€â”€ ğŸ“„ README.md                # Ce fichier
```

---

## ğŸ“„ Licence

Ce projet est sous licence MIT. Voir le fichier [LICENSE](LICENSE) pour plus de dÃ©tails.
